### 0001. 关于iPhone 使用trancy插件的注意的注意事项
* 在Safari 浏览器中, 访问youtube, 打开Trancy, 有时无法显示双语, 须在访问前, 关闭VPN, 再开启VPN。
* 每个视频似乎都需要如此操作。
* iPad 端是否需要相同的操作，待测试。原理相同吧。

---
### 0002. 关于 iPhone 使用 Trancy 插件的注意事项
* **iOS Safari + YouTube + Trancy + VPN 的典型问题说明**

---
* **现象描述**
  - 在 iPhone 的 Safari 浏览器中访问 YouTube
  - 打开 Trancy 插件后，有时无法显示双语字幕
  - 必须在访问视频前关闭 VPN，进入视频后再开启 VPN
  - 几乎每一个视频都需要重复此操作
  - iPad 端是否需要相同操作，尚待测试

---
* **结论概要**
  - iPhone 与 iPad 端原理完全一致
  - 问题并非 Trancy 本身失效
  - 本质是 **VPN + iOS Safari 扩展机制 + YouTube 字幕请求初始化** 共同导致

---
* **Trancy 在 iOS Safari 上的工作方式（简化）**
  - 作为 Safari Web Extension 运行
  - 监听页面加载过程
  - 拦截 YouTube 的字幕请求（caption / timedtext）
  - 将原字幕替换或叠加为双语字幕
  - 字幕请求是独立于视频流的单独网络请求

---
* **VPN 对 YouTube 字幕请求的影响**
  - YouTube 字幕接口依赖以下因素：
    - 当前 IP 所在地区
    - CDN 节点
    - cookies / localStorage
    - 页面初始化时的网络环境
  - VPN 会改变：
    - IP 地址
    - 区域判定
    - 字幕接口返回结构

---
* **问题产生的关键流程（错误示例）**
  - VPN 已开启
  - Safari 打开 YouTube 视频页面
  - 页面初始化时绑定 VPN 网络环境
  - 字幕接口返回异常 / 结构不兼容
  - Trancy 注入脚本，但无法正确拦截字幕
  - 最终导致双语字幕无法显示
  - 页面初始化完成后，扩展无法重新绑定字幕接口

---
* **为何"关闭 VPN → 打开视频 → 再开启 VPN"可以解决**
  - 正确流程如下：
    - 关闭 VPN
    - 打开 YouTube 视频
    - 字幕接口使用本地 / 正常网络初始化
    - Trancy 成功拦截字幕
    - 再开启 VPN，仅影响后续网络流量
  - 字幕接口已完成初始化，后续 VPN 切换不再影响字幕显示

---
* **为何每个视频都需要重复操作**
  - 每个视频对应独立的字幕请求
  - iOS Safari 对扩展与脚本注入限制严格
  - 页面刷新或跳转即重新初始化环境
  - 不会复用上一个视频的字幕绑定状态

---
* **iPhone 与 iPad 行为对比**
  - 使用相同的 WebKit 内核
  - Safari 扩展机制一致
  - VPN 对网络路径的影响一致
  - Trancy 行为一致
  - iPad 仅在内存与页面存活时间上略有优势
  - 不改变问题本质

---
* **为何桌面端（Chrome）问题较少**
  - 插件 API 权限更高
  - 可主动重试网络请求
  - Service Worker 可常驻
  - 对网络变化与 VPN 状态更敏感
  - iOS Safari 扩展属于"寄生式"，无法感知网络切换

---
* **推荐使用流程（最稳定）**
  - 打开 YouTube 前关闭 VPN
  - 进入视频页面
  - 确认 Trancy 双语字幕正常显示
  - 再开启 VPN

---
* **不推荐做法**
  - 开着 VPN 直接频繁切换视频
  - 依赖 Safari 自动修复字幕请求
  - 认为这是 Trancy 的单纯 Bug

---
* **备注**
  - 此问题为 iOS 系统机制层面的限制
  - 属于长期存在的结构性问题
  - 并非单一插件或用户配置错误

---
### 0003. iOS Safari + YouTube + Trancy + VPN 的典型问题说明（补充细节）
* **关键细节补充说明（实际操作中的"绕口令现象"）**
  - 在某些网络环境下：
    - **关闭 VPN 时，YouTube 本身无法访问**
    - 必须先开启 VPN，才能进入 YouTube 页面
  - 但在 VPN 已开启的状态下：
    - Trancy 插件往往无法正常加载或拦截字幕
    - 双语字幕必然加载失败

---
* **实际可行但反直觉的操作流程**
  - 开启 VPN
  - 打开 YouTube 视频页面
  - Trancy 插件已注入，但字幕必然加载失败
  - 此时关闭 VPN
  - Safari 继续播放一小段视频（依赖已缓存的数据）
  - 视频随后卡住（因 VPN 已关闭，后续数据无法加载）
  - 再次开启 VPN
  - 视频恢复加载
  - 此时 Trancy 双语字幕可以正常显示

---
* **为何这种"绕口令式"流程能成立**
  - 原因在于三个机制叠加：
    - Safari 页面与脚本状态未被刷新
    - YouTube 视频流具备短时缓存能力
    - Trancy 的字幕拦截已在"无 VPN 状态"下完成初始化
  - 关键点不在视频是否播放
  - 而在于 **字幕接口初始化发生的那一刻**

---
* **底层机制拆解**
  - YouTube 页面初始化时：
    - 视频流
    - 字幕接口
    - 插件脚本
    是并行但独立的
  - 字幕接口一旦成功绑定：
    - 即使网络环境随后发生变化
    - Safari 也不会强制重新初始化字幕请求
  - VPN 的再次开启：
    - 仅影响后续视频流数据
    - 不会破坏已建立的字幕拦截关系

---
* **为何视频会"同步一段时间再卡住"**
  - YouTube 视频采用分段加载（chunk / segment）
  - Safari 会缓存已下载的视频分片
  - 关闭 VPN 后：
    - 已缓存分片仍可播放
    - 新分片请求失败
  - 因此出现：
    - 视频短暂继续
    - 随后卡住的现象

---
* **为何重新开启 VPN 后一切又恢复**
  - 页面未刷新
  - JS 扩展未被销毁
  - 字幕拦截关系仍然存在
  - 网络恢复后：
    - 视频流继续
    - 双语字幕保持正常

---
* **现象总结**
  - 看似混乱、绕口
  - 实际上是：
    - 网络层（VPN）
    - 页面生命周期（Safari）
    - 插件注入时机（Trancy）
    - 内容缓存机制（YouTube）
    四者之间的时间差博弈
  - 属于 iOS 平台下高度典型、可复现的问题

---
* **备注**
  - 该流程并非推荐操作
  - 只是当前环境下"能用"的权宜之计
  - 本质限制来自 iOS Safari 的扩展与网络机制

---
![alt text](https://upload-bbs.miyoushe.com/upload/2022/11/01/266607709/6cc988d046df34315681e50f9c9f299c_1259576169906078498.PNG?x-oss-process=image//resize,s_600/quality,q_80/auto-orient,0/interlace,1/format,png)